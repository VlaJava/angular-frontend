<div class="profile-page-container" *ngIf="user; else loading">
  <!-- Coluna da Esquerda: Imagem de Perfil -->
  <div class="profile-picture-container">
    <img [src]="user.imageUrl || 'https://placehold.co/400x400/EFEFEF/333333?text=Perfil'" alt="Foto de Perfil" class="profile-picture">
    
    <input type="file" #fileInput hidden (change)="onFileSelected($event)" accept="image/png, image/jpeg">
    
    <button class="btn-change-picture" (click)="fileInput.click()">Trocar Foto</button>
  </div>

  <!-- Coluna da Direita: Cartão de Informações -->
  <div class="profile-card">
    <h2 class="profile-title">Meu Perfil</h2>

    <!-- MODO DE VISUALIZAÇÃO -->
    <div *ngIf="!isEditing" class="details-view">
      <div class="info-group">
        <label>Nome Completo</label>
        <p>{{ user.name }}</p>
      </div>
      <div class="info-group">
        <label>Email</label>
        <p class="email-field">{{ user.email }}</p>
      </div>
      <div class="info-group">
        <label>Documento</label>
        <p>{{ user.document }}</p>
      </div>
      <div class="info-group">
        <label>Telefone</label>
        <p>{{ user.phone }}</p>
      </div>
    </div>

    <!-- MODO DE EDIÇÃO -->
    <form *ngIf="isEditing" [formGroup]="profileForm" (ngSubmit)="onProfileSubmit()" class="edit-form">
      <div class="form-group">
        <label for="name">Nome Completo</label>
        <input id="name" type="text" formControlName="name" class="form-control">
      </div>
      <div class="form-group">
        <label for="document">Documento</label>
        <input id="document" type="text" formControlName="document" class="form-control">
      </div>
      <div class="form-group">
        <label for="phone">Telefone</label>
        <input id="phone" type="text" formControlName="phone" class="form-control">
      </div>
    </form>
    
    <!-- Botões de Ação -->
    <div class="profile-actions">
      <div *ngIf="!isEditing" class="view-actions">
        <a class="action-link-danger" (click)="deactivateAccount()">Excluir Perfil</a>
        <button class="btn-secondary" (click)="navigateToChangePassword()">Definir nova senha</button>
        <button class="btn-primary" (click)="toggleEditMode()">Editar Perfil</button>
      </div>
      <div *ngIf="isEditing" class="edit-actions">
        <button type="button" class="btn-secondary" (click)="toggleEditMode()">Cancelar</button>
        <button type="submit" class="btn-primary" (click)="onProfileSubmit()" [disabled]="profileForm.invalid">Salvar Alterações</button>
      </div>
    </div>
  </div>
</div>

<ng-template #loading>
  <p class="text-center mt-5">A carregar perfil...</p>
</ng-template>
